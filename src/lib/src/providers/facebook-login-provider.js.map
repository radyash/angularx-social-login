{"version":3,"file":"facebook-login-provider.js","sourceRoot":"","sources":["facebook-login-provider.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA,uEAAoE;AACpE,yCAA8C;AAK9C;IAA2C,yCAAiB;IAIxD,+BACY,QAAgB,EAChB,GAAiD,EACjD,MAAwB,EACxB,MAA0D,EAC1D,OAAwB;QAHxB,oBAAA,EAAA,QAAkB,KAAK,EAAE,sBAAsB,EAAE;QACjD,uBAAA,EAAA,gBAAwB;QACxB,uBAAA,EAAA,kDAA0D;QAC1D,wBAAA,EAAA,gBAAwB;QALpC,YAMI,iBAAO,SAAG;QALF,cAAQ,GAAR,QAAQ,CAAQ;QAChB,SAAG,GAAH,GAAG,CAA8C;QACjD,YAAM,GAAN,MAAM,CAAkB;QACxB,YAAM,GAAN,MAAM,CAAoD;QAC1D,aAAO,GAAP,OAAO,CAAiB;;IACvB,CAAC;IAEd,0CAAU,GAAV;QAAA,iBAkBC;QAjBG,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YAC/B,KAAI,CAAC,UAAU,CAAC,qBAAqB,CAAC,WAAW,EAC7C,4BAA0B,KAAI,CAAC,MAAM,YAAS,EAC9C;gBACI,EAAE,CAAC,IAAI,CAAC;oBACJ,KAAK,EAAE,KAAI,CAAC,QAAQ;oBACpB,gBAAgB,EAAE,IAAI;oBACtB,MAAM,EAAE,IAAI;oBACZ,KAAK,EAAE,IAAI;oBACX,OAAO,EAAE,KAAI,CAAC,OAAO;iBACxB,CAAC,CAAC;gBACH,2CAA2C;gBAE3C,KAAI,CAAC,WAAW,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC5B,OAAO,EAAE,CAAC;YACd,CAAC,CAAC,CAAC;QACX,CAAC,CAAC,CAAC;IACP,CAAC;IAED,8CAAc,GAAd;QAAA,iBA2BC;QA1BG,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YAC/B,KAAI,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC;gBAChB,EAAE,CAAC,cAAc,CAAC,UAAC,QAAa;oBAC5B,IAAI,QAAQ,CAAC,MAAM,KAAK,WAAW,EAAE;wBACjC,IAAI,cAAY,GAAG,QAAQ,CAAC,YAAY,CAAC;wBACzC,EAAE,CAAC,GAAG,CAAC,gBAAc,KAAI,CAAC,MAAQ,EAAE,UAAC,MAAW;4BAC5C,IAAI,IAAI,GAAe,IAAI,iBAAU,EAAE,CAAC;4BAExC,IAAI,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE,CAAC;4BACpB,IAAI,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;4BACxB,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;4BAC1B,IAAI,CAAC,QAAQ,GAAG,6BAA6B,GAAG,MAAM,CAAC,EAAE,GAAG,sBAAsB,CAAC;4BACnF,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,UAAU,CAAC;4BACnC,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,SAAS,CAAC;4BACjC,IAAI,CAAC,SAAS,GAAG,cAAY,CAAC,WAAW,CAAC;4BAE1C,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC;4BAEvB,OAAO,CAAC,IAAI,CAAC,CAAC;wBAClB,CAAC,CAAC,CAAC;qBACN;yBAAM;wBACH,MAAM,CAAC,iCAAiC,CAAC,CAAC;qBAC7C;gBACL,CAAC,CAAC,CAAC;YACP,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC;IAED,sCAAM,GAAN,UAAO,GAAc;QAArB,iBA2BC;QA1BG,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YAC/B,KAAI,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC;gBAChB,EAAE,CAAC,KAAK,CAAC,UAAC,QAAa;oBACnB,IAAI,QAAQ,CAAC,YAAY,EAAE;wBACvB,IAAI,cAAY,GAAG,QAAQ,CAAC,YAAY,CAAC;wBACzC,EAAE,CAAC,GAAG,CAAC,gBAAc,KAAI,CAAC,MAAQ,EAAE,UAAC,MAAW;4BAC5C,IAAI,IAAI,GAAe,IAAI,iBAAU,EAAE,CAAC;4BAExC,IAAI,CAAC,EAAE,GAAG,MAAM,CAAC,EAAE,CAAC;4BACpB,IAAI,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;4BACxB,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;4BAC1B,IAAI,CAAC,QAAQ,GAAG,6BAA6B,GAAG,MAAM,CAAC,EAAE,GAAG,sBAAsB,CAAC;4BACnF,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,UAAU,CAAC;4BACnC,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC,SAAS,CAAC;4BACjC,IAAI,CAAC,SAAS,GAAG,cAAY,CAAC,WAAW,CAAC;4BAE1C,IAAI,CAAC,QAAQ,GAAG,MAAM,CAAC;4BAEvB,OAAO,CAAC,IAAI,CAAC,CAAC;wBAClB,CAAC,CAAC,CAAC;qBACN;yBAAM;wBACH,MAAM,CAAC,kDAAkD,CAAC,CAAC;qBAC9D;gBACL,CAAC,EAAE,KAAI,CAAC,GAAG,CAAC,CAAC;YACjB,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC;IAED,uCAAO,GAAP;QAAA,iBAQC;QAPG,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;YAC/B,KAAI,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC;gBAChB,EAAE,CAAC,MAAM,CAAC,UAAC,QAAa;oBACpB,OAAO,EAAE,CAAC;gBACd,CAAC,CAAC,CAAC;YACP,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACP,CAAC;IAhGsB,iCAAW,GAAW,UAAU,CAAC;IAkG5D,4BAAC;CAAA,AApGD,CAA2C,uCAAiB,GAoG3D;AApGY,sDAAqB","sourcesContent":["import { BaseLoginProvider } from '../entities/base-login-provider';\nimport { SocialUser } from '../entities/user';\nimport { LoginOpt } from '../auth.service';\n\ndeclare let FB: any;\n\nexport class FacebookLoginProvider extends BaseLoginProvider {\n\n    public static readonly PROVIDER_ID: string = 'FACEBOOK';\n\n    constructor(\n        private clientId: string,\n        private opt: LoginOpt = { scope: 'email,public_profile' },\n        private locale: string = 'en_US',\n        private fields: string = 'name,email,picture,first_name,last_name',\n        private version: string = 'v2.9'\n    ) { super(); }\n\n    initialize(): Promise<void> {\n        return new Promise((resolve, reject) => {\n            this.loadScript(FacebookLoginProvider.PROVIDER_ID,\n                `//connect.facebook.net/${this.locale}/sdk.js`,\n                () => {\n                    FB.init({\n                        appId: this.clientId,\n                        autoLogAppEvents: true,\n                        cookie: true,\n                        xfbml: true,\n                        version: this.version\n                    });\n                    // FB.AppEvents.logPageView(); #FIX for #18\n\n                    this._readyState.next(true);\n                    resolve();\n                });\n        });\n    }\n\n    getLoginStatus(): Promise<SocialUser> {\n        return new Promise((resolve, reject) => {\n            this.onReady().then(() => {\n                FB.getLoginStatus((response: any) => {\n                    if (response.status === 'connected') {\n                        let authResponse = response.authResponse;\n                        FB.api(`/me?fields=${this.fields}`, (fbUser: any) => {\n                            let user: SocialUser = new SocialUser();\n\n                            user.id = fbUser.id;\n                            user.name = fbUser.name;\n                            user.email = fbUser.email;\n                            user.photoUrl = 'https://graph.facebook.com/' + fbUser.id + '/picture?type=normal';\n                            user.firstName = fbUser.first_name;\n                            user.lastName = fbUser.last_name;\n                            user.authToken = authResponse.accessToken;\n\n                            user.facebook = fbUser;\n\n                            resolve(user);\n                        });\n                    } else {\n                        reject('No user is currently logged in.');\n                    }\n                });\n            });\n        });\n    }\n\n    signIn(opt?: LoginOpt): Promise<SocialUser> {\n        return new Promise((resolve, reject) => {\n            this.onReady().then(() => {\n                FB.login((response: any) => {\n                    if (response.authResponse) {\n                        let authResponse = response.authResponse;\n                        FB.api(`/me?fields=${this.fields}`, (fbUser: any) => {\n                            let user: SocialUser = new SocialUser();\n\n                            user.id = fbUser.id;\n                            user.name = fbUser.name;\n                            user.email = fbUser.email;\n                            user.photoUrl = 'https://graph.facebook.com/' + fbUser.id + '/picture?type=normal';\n                            user.firstName = fbUser.first_name;\n                            user.lastName = fbUser.last_name;\n                            user.authToken = authResponse.accessToken;\n\n                            user.facebook = fbUser;\n\n                            resolve(user);\n                        });\n                    } else {\n                        reject('User cancelled login or did not fully authorize.');\n                    }\n                }, this.opt);\n            });\n        });\n    }\n\n    signOut(): Promise<any> {\n        return new Promise((resolve, reject) => {\n            this.onReady().then(() => {\n                FB.logout((response: any) => {\n                    resolve();\n                });\n            });\n        });\n    }\n\n}\n"]}